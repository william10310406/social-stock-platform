<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–® Socket.IO æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        #log { background: #f5f5f5; padding: 10px; height: 300px; overflow-y: auto; border: 1px solid #ddd; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ğŸ”Œ ç°¡å–® Socket.IO é€£æ¥æ¸¬è©¦</h1>
    <button onclick="simpleTest()">é–‹å§‹ç°¡å–®æ¸¬è©¦</button>
    <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
    <div id="log"></div>

    <!-- ä½¿ç”¨ç¢ºå®šå…¼å®¹çš„ Socket.IO 4.0.1 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function simpleTest() {
            clearLog();
            log('ğŸš€ é–‹å§‹ç°¡å–® Socket.IO æ¸¬è©¦...', 'info');

            try {
                // æœ€ç°¡å–®çš„é€£æ¥é…ç½®
                const socket = io('/', {
                    transports: ['polling'],
                    timeout: 10000,
                    forceNew: true
                });

                let connectionSuccessful = false;

                socket.on('connect', function() {
                    connectionSuccessful = true;
                    log('âœ… é€£æ¥æˆåŠŸï¼', 'success');
                    log(`Session ID: ${socket.id}`, 'info');

                    // ç™¼é€ä¸€å€‹ç°¡å–®çš„ ping
                    socket.emit('ping', { test: true, time: Date.now() });
                    log('ğŸ“¤ ç™¼é€ ping', 'info');

                    // 3ç§’å¾Œæ–·é–‹
                    setTimeout(() => {
                        socket.disconnect();
                        log('âœ… ä¸»å‹•æ–·é–‹é€£æ¥', 'info');
                    }, 3000);
                });

                socket.on('pong', function(data) {
                    log(`ğŸ“ æ”¶åˆ° pong: ${JSON.stringify(data)}`, 'success');
                });

                socket.on('connect_error', function(error) {
                    log(`âŒ é€£æ¥å¤±æ•—: ${error.message}`, 'error');
                });

                socket.on('disconnect', function(reason) {
                    log(`ğŸ”Œ æ–·é–‹: ${reason}`, 'info');
                });

                // 5ç§’å¾Œæª¢æŸ¥çµæœ
                setTimeout(() => {
                    if (connectionSuccessful) {
                        log('ğŸ‰ ç°¡å–®æ¸¬è©¦æˆåŠŸï¼Socket.IO åŸºæœ¬åŠŸèƒ½æ­£å¸¸ï¼', 'success');
                    } else {
                        log('âŒ ç°¡å–®æ¸¬è©¦å¤±æ•—', 'error');
                    }
                }, 5000);

            } catch (error) {
                log(`âŒ æ¸¬è©¦éŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆï¼Œé»æ“ŠæŒ‰éˆ•é–‹å§‹æ¸¬è©¦', 'info');
        });
    </script>
</body>
</html>
