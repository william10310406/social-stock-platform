<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Component Library Test - Stock Insight Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .test-section {
        @apply mb-8 p-6 bg-white rounded-lg shadow-md border;
      }
      .test-button {
        @apply px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mr-2 mb-2 transition-colors;
      }
      .test-result {
        @apply mt-4 p-3 rounded-md;
      }
      .test-success {
        @apply bg-green-100 text-green-800 border border-green-200;
      }
      .test-error {
        @apply bg-red-100 text-red-800 border border-red-200;
      }
      .code-block {
        @apply bg-gray-100 p-3 rounded text-sm font-mono text-gray-800 mt-2;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸ“š Component Library Test</h1>
        <p class="text-gray-600">æ¸¬è©¦ Stock Insight Platform çµ„ä»¶åº«åŠŸèƒ½</p>
        <div id="lib-status" class="mt-4 p-3 rounded-md bg-yellow-100 text-yellow-800">
          æ­£åœ¨è¼‰å…¥çµ„ä»¶åº«...
        </div>
      </div>

      <!-- Toast çµ„ä»¶æ¸¬è©¦ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">ğŸ Toast çµ„ä»¶æ¸¬è©¦</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
          <button id="test-toast-success" class="test-button">Success Toast</button>
          <button id="test-toast-error" class="test-button">Error Toast</button>
          <button id="test-toast-warning" class="test-button">Warning Toast</button>
          <button id="test-toast-info" class="test-button">Info Toast</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <button id="test-toast-custom" class="test-button">Custom Toast</button>
          <button id="test-toast-clear" class="test-button bg-red-600 hover:bg-red-700">
            Clear All
          </button>
        </div>
        <div id="toast-result" class="test-result hidden"></div>
        <div class="code-block">
          <strong>æ¸¬è©¦ä»£ç¢¼:</strong><br />
          toast.success('æ“ä½œæˆåŠŸï¼');<br />
          toast.error('ç™¼ç”ŸéŒ¯èª¤');<br />
          toast.warning('è­¦å‘Šè¨Šæ¯');<br />
          toast.info('æç¤ºè¨Šæ¯');
        </div>
      </div>

      <!-- Modal çµ„ä»¶æ¸¬è©¦ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">ğŸªŸ Modal çµ„ä»¶æ¸¬è©¦</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
          <button id="test-modal-small" class="test-button">Small Modal</button>
          <button id="test-modal-default" class="test-button">Default Modal</button>
          <button id="test-modal-large" class="test-button">Large Modal</button>
          <button id="test-modal-xl" class="test-button">XL Modal</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          <button id="test-modal-confirm" class="test-button">Confirm Dialog</button>
          <button id="test-modal-alert" class="test-button">Alert Dialog</button>
        </div>
        <div id="modal-result" class="test-result hidden"></div>
        <div class="code-block">
          <strong>æ¸¬è©¦ä»£ç¢¼:</strong><br />
          const modal = new Modal({ size: 'large' });<br />
          modal.open({ title: 'æ¸¬è©¦', body: 'å…§å®¹' });<br />
          Modal.confirm({ message: 'ç¢ºèªå—ï¼Ÿ' });
        </div>
      </div>

      <!-- Loading çµ„ä»¶æ¸¬è©¦ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">â³ Loading çµ„ä»¶æ¸¬è©¦</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
          <button id="test-loading-fullscreen" class="test-button">Fullscreen Loading</button>
          <button id="test-loading-container" class="test-button">Container Loading</button>
          <button id="test-loading-skeleton" class="test-button">Skeleton Loading</button>
          <button id="test-loading-error" class="test-button">Error State</button>
        </div>
        <div id="loading-test-container" class="mt-4 p-4 border rounded bg-gray-50 min-h-[100px]">
          <p>é€™æ˜¯æ¸¬è©¦å®¹å™¨ï¼Œé»æ“Šä¸Šæ–¹æŒ‰éˆ•æ¸¬è©¦è¼‰å…¥æ•ˆæœ</p>
        </div>
        <div id="loading-result" class="test-result hidden"></div>
        <div class="code-block">
          <strong>æ¸¬è©¦ä»£ç¢¼:</strong><br />
          loading.showFullscreen('è¼‰å…¥ä¸­...');<br />
          loading.showInContainer('#container', 'skeleton');<br />
          loading.showError('#container', 'è¼‰å…¥å¤±æ•—');
        </div>
      </div>

      <!-- Formatter å·¥å…·æ¸¬è©¦ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">ğŸ”§ Formatter å·¥å…·æ¸¬è©¦</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
          <button id="test-formatter-currency" class="test-button">Currency Format</button>
          <button id="test-formatter-number" class="test-button">Number Format</button>
          <button id="test-formatter-date" class="test-button">Date Format</button>
          <button id="test-formatter-stock" class="test-button">Stock Format</button>
        </div>
        <div id="formatter-output" class="mt-4 p-4 border rounded bg-gray-50 min-h-[100px]">
          <p class="text-gray-600">é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŸ¥çœ‹æ ¼å¼åŒ–çµæœ</p>
        </div>
        <div id="formatter-result" class="test-result hidden"></div>
        <div class="code-block">
          <strong>æ¸¬è©¦ä»£ç¢¼:</strong><br />
          formatter.currency(1234.56); // "NT$1,234.56"<br />
          formatter.stockChange(0.15); // ç´…æ¼²ç¶ è·Œ<br />
          formatter.volume(12340000); // "1,234è¬"
        </div>
      </div>

      <!-- å…¨å±€è®Šæ•¸æ¸¬è©¦ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">ğŸŒ å…¨å±€è®Šæ•¸æ¸¬è©¦</h2>
        <button id="test-global-vars" class="test-button">æª¢æŸ¥å…¨å±€è®Šæ•¸</button>
        <div id="global-vars-output" class="mt-4 p-4 border rounded bg-gray-50 min-h-[100px]">
          <p class="text-gray-600">é»æ“ŠæŒ‰éˆ•æª¢æŸ¥å…¨å±€è®Šæ•¸æ˜¯å¦æ­£ç¢ºè¨»å†Š</p>
        </div>
      </div>

      <!-- æ¸¬è©¦ç¸½çµ -->
      <div class="test-section">
        <h2 class="text-xl font-semibold mb-4">ğŸ“Š æ¸¬è©¦ç¸½çµ</h2>
        <button id="run-all-tests" class="test-button bg-green-600 hover:bg-green-700">
          åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        </button>
        <div id="test-summary" class="mt-4 p-4 border rounded bg-gray-50">
          <p class="text-gray-600">é»æ“Šã€ŒåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ã€æŸ¥çœ‹å®Œæ•´æ¸¬è©¦çµæœ</p>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="/src/js/config/routes-docker.js"></script>
    <script type="module" src="/src/js/utils/pathManager.js"></script>
    <script type="module" src="/src/lib/index.js"></script>

    <script type="module">
      // ç­‰å¾…çµ„ä»¶åº«è¼‰å…¥
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(initTests, 100);
      });

      function initTests() {
        const statusEl = document.getElementById('lib-status');

        // æª¢æŸ¥çµ„ä»¶åº«æ˜¯å¦è¼‰å…¥
        if (window.lib && window.toast && window.Modal && window.loading && window.formatter) {
          statusEl.className = 'mt-4 p-3 rounded-md bg-green-100 text-green-800';
          statusEl.textContent = 'âœ… çµ„ä»¶åº«è¼‰å…¥æˆåŠŸï¼';
          setupTests();
        } else {
          statusEl.className = 'mt-4 p-3 rounded-md bg-red-100 text-red-800';
          statusEl.textContent = 'âŒ çµ„ä»¶åº«è¼‰å…¥å¤±æ•—ï¼';
          console.error('Component library not loaded properly');
        }
      }

      function setupTests() {
        // Toast æ¸¬è©¦
        document.getElementById('test-toast-success').onclick = () => {
          toast.success('é€™æ˜¯æˆåŠŸè¨Šæ¯ï¼');
          showResult('toast-result', 'âœ… Success Toast æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-toast-error').onclick = () => {
          toast.error('é€™æ˜¯éŒ¯èª¤è¨Šæ¯ï¼');
          showResult('toast-result', 'âœ… Error Toast æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-toast-warning').onclick = () => {
          toast.warning('é€™æ˜¯è­¦å‘Šè¨Šæ¯ï¼');
          showResult('toast-result', 'âœ… Warning Toast æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-toast-info').onclick = () => {
          toast.info('é€™æ˜¯æç¤ºè¨Šæ¯ï¼');
          showResult('toast-result', 'âœ… Info Toast æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-toast-custom').onclick = () => {
          toast.show('è‡ªå®šç¾©è¨Šæ¯', 'info', {
            title: 'è‡ªå®šç¾©æ¨™é¡Œ',
            duration: 8000,
            onClick: () => console.log('Toast è¢«é»æ“Š'),
          });
          showResult('toast-result', 'âœ… Custom Toast æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-toast-clear').onclick = () => {
          toast.clearAll();
          showResult('toast-result', 'âœ… Clear All æ¸¬è©¦é€šé', 'success');
        };

        // Modal æ¸¬è©¦
        document.getElementById('test-modal-small').onclick = () => {
          const modal = new Modal({ size: 'small' });
          modal.open({
            title: 'Small Modal',
            body: '<p>é€™æ˜¯ä¸€å€‹å°å°ºå¯¸çš„æ¨¡æ…‹æ¡†</p>',
          });
          showResult('modal-result', 'âœ… Small Modal æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-modal-default').onclick = () => {
          const modal = new Modal();
          modal.open({
            title: 'Default Modal',
            body: '<p>é€™æ˜¯ä¸€å€‹é è¨­å°ºå¯¸çš„æ¨¡æ…‹æ¡†</p>',
          });
          showResult('modal-result', 'âœ… Default Modal æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-modal-large').onclick = () => {
          const modal = new Modal({ size: 'large' });
          modal.open({
            title: 'Large Modal',
            body: '<p>é€™æ˜¯ä¸€å€‹å¤§å°ºå¯¸çš„æ¨¡æ…‹æ¡†</p><p>å¯ä»¥åŒ…å«æ›´å¤šå…§å®¹...</p>',
          });
          showResult('modal-result', 'âœ… Large Modal æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-modal-xl').onclick = () => {
          const modal = new Modal({ size: 'xl' });
          modal.open({
            title: 'Extra Large Modal',
            body: '<p>é€™æ˜¯ä¸€å€‹è¶…å¤§å°ºå¯¸çš„æ¨¡æ…‹æ¡†</p><p>é©åˆé¡¯ç¤ºå¤§é‡å…§å®¹</p>',
          });
          showResult('modal-result', 'âœ… XL Modal æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-modal-confirm').onclick = () => {
          Modal.confirm({
            title: 'ç¢ºèªæ¸¬è©¦',
            message: 'é€™æ˜¯ä¸€å€‹ç¢ºèªå°è©±æ¡†ï¼Œæ‚¨è¦ç¹¼çºŒå—ï¼Ÿ',
            onConfirm: () => toast.success('æ‚¨é»æ“Šäº†ç¢ºèª'),
            onCancel: () => toast.info('æ‚¨é»æ“Šäº†å–æ¶ˆ'),
          });
          showResult('modal-result', 'âœ… Confirm Dialog æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-modal-alert').onclick = () => {
          Modal.alert({
            title: 'æç¤ºæ¸¬è©¦',
            message: 'é€™æ˜¯ä¸€å€‹æç¤ºå°è©±æ¡†',
            onClose: () => toast.info('Alert å°è©±æ¡†å·²é—œé–‰'),
          });
          showResult('modal-result', 'âœ… Alert Dialog æ¸¬è©¦é€šé', 'success');
        };

        // Loading æ¸¬è©¦
        document.getElementById('test-loading-fullscreen').onclick = () => {
          loading.showFullscreen('æ¸¬è©¦å…¨å±è¼‰å…¥...', 'test');
          setTimeout(() => {
            loading.hideFullscreen('test');
            showResult('loading-result', 'âœ… Fullscreen Loading æ¸¬è©¦é€šé', 'success');
          }, 2000);
        };

        document.getElementById('test-loading-container').onclick = () => {
          const container = document.getElementById('loading-test-container');
          loading.showInContainer(container, 'spinner', 'å®¹å™¨è¼‰å…¥ä¸­...');
          setTimeout(() => {
            loading.hideInContainer(container);
            showResult('loading-result', 'âœ… Container Loading æ¸¬è©¦é€šé', 'success');
          }, 3000);
        };

        document.getElementById('test-loading-skeleton').onclick = () => {
          const container = document.getElementById('loading-test-container');
          loading.showInContainer(container, 'skeleton');
          setTimeout(() => {
            loading.hideInContainer(container);
            showResult('loading-result', 'âœ… Skeleton Loading æ¸¬è©¦é€šé', 'success');
          }, 3000);
        };

        document.getElementById('test-loading-error').onclick = () => {
          const container = document.getElementById('loading-test-container');
          loading.showError(container, 'è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦', () => {
            toast.info('é‡è©¦æŒ‰éˆ•è¢«é»æ“Š');
            loading.hideInContainer(container);
          });
          showResult('loading-result', 'âœ… Error State æ¸¬è©¦é€šé', 'success');
        };

        // Formatter æ¸¬è©¦
        document.getElementById('test-formatter-currency').onclick = () => {
          const output = document.getElementById('formatter-output');
          const results = [
            `Currency: ${formatter.currency(1234.56)}`,
            `Currency (USD): ${formatter.currency(1234.56, 'USD')}`,
            `Number only: ${formatter.currency(1234.56, 'TWD', { showSymbol: false })}`,
          ];
          output.innerHTML = `<h4 class="font-semibold mb-2">è²¨å¹£æ ¼å¼åŒ–çµæœ:</h4>${results.map((r) => `<p>${r}</p>`).join('')}`;
          showResult('formatter-result', 'âœ… Currency Format æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-formatter-number').onclick = () => {
          const output = document.getElementById('formatter-output');
          const results = [
            `Number: ${formatter.number(1234567.89)}`,
            `Percentage: ${formatter.percentage(0.1234)}`,
            `Short Number: ${formatter.shortNumber(1234567)}`,
          ];
          output.innerHTML = `<h4 class="font-semibold mb-2">æ•¸å­—æ ¼å¼åŒ–çµæœ:</h4>${results.map((r) => `<p>${r}</p>`).join('')}`;
          showResult('formatter-result', 'âœ… Number Format æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-formatter-date').onclick = () => {
          const output = document.getElementById('formatter-output');
          const now = new Date();
          const results = [
            `Date (short): ${formatter.date(now, 'short')}`,
            `Date (medium): ${formatter.date(now, 'medium')}`,
            `Time: ${formatter.time(now)}`,
            `Relative: ${formatter.relativeTime(new Date(Date.now() - 3600000))}`,
          ];
          output.innerHTML = `<h4 class="font-semibold mb-2">æ—¥æœŸæ ¼å¼åŒ–çµæœ:</h4>${results.map((r) => `<p>${r}</p>`).join('')}`;
          showResult('formatter-result', 'âœ… Date Format æ¸¬è©¦é€šé', 'success');
        };

        document.getElementById('test-formatter-stock').onclick = () => {
          const output = document.getElementById('formatter-output');
          const change1 = formatter.stockChange(0.15);
          const change2 = formatter.stockChange(-0.25);
          const results = [
            `Stock Change (+): ${change1.value} (${change1.color})`,
            `Stock Change (-): ${change2.value} (${change2.color})`,
            `Volume: ${formatter.volume(12340000)}`,
            `Volume (å„„): ${formatter.volume(123400000)}`,
          ];
          output.innerHTML = `<h4 class="font-semibold mb-2">è‚¡ç¥¨æ ¼å¼åŒ–çµæœ:</h4>${results.map((r) => `<p>${r}</p>`).join('')}`;
          showResult('formatter-result', 'âœ… Stock Format æ¸¬è©¦é€šé', 'success');
        };

        // å…¨å±€è®Šæ•¸æ¸¬è©¦
        document.getElementById('test-global-vars').onclick = () => {
          const output = document.getElementById('global-vars-output');
          const checks = [
            { name: 'window.lib', exists: !!window.lib },
            { name: 'window.toast', exists: !!window.toast },
            { name: 'window.Toast', exists: !!window.Toast },
            { name: 'window.Modal', exists: !!window.Modal },
            { name: 'window.loading', exists: !!window.loading },
            { name: 'window.Loading', exists: !!window.Loading },
            { name: 'window.formatter', exists: !!window.formatter },
            { name: 'window.Formatter', exists: !!window.Formatter },
          ];

          const results = checks
            .map(
              (check) =>
                `<p class="${check.exists ? 'text-green-600' : 'text-red-600'}">
                        ${check.exists ? 'âœ…' : 'âŒ'} ${check.name}
                    </p>`,
            )
            .join('');

          output.innerHTML = `<h4 class="font-semibold mb-2">å…¨å±€è®Šæ•¸æª¢æŸ¥:</h4>${results}`;
        };

        // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        document.getElementById('run-all-tests').onclick = () => {
          runAllTests();
        };
      }

      function showResult(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.className = `test-result test-${type}`;
        element.textContent = message;
        element.classList.remove('hidden');
      }

      function runAllTests() {
        const summary = document.getElementById('test-summary');
        let results = [];

        // æª¢æŸ¥æ‰€æœ‰çµ„ä»¶æ˜¯å¦å­˜åœ¨
        const components = [
          {
            name: 'Toast',
            check: () => window.toast && typeof window.toast.success === 'function',
          },
          { name: 'Modal', check: () => window.Modal && typeof window.Modal === 'function' },
          {
            name: 'Loading',
            check: () => window.loading && typeof window.loading.showFullscreen === 'function',
          },
          {
            name: 'Formatter',
            check: () => window.formatter && typeof window.formatter.currency === 'function',
          },
        ];

        components.forEach((comp) => {
          try {
            const passed = comp.check();
            results.push(`<p class="${passed ? 'text-green-600' : 'text-red-600'}">
                        ${passed ? 'âœ…' : 'âŒ'} ${comp.name} çµ„ä»¶
                    </p>`);
          } catch (error) {
            results.push(
              `<p class="text-red-600">âŒ ${comp.name} çµ„ä»¶ (éŒ¯èª¤: ${error.message})</p>`,
            );
          }
        });

        const passedCount = results.filter((r) => r.includes('âœ…')).length;
        const totalCount = results.length;

        summary.innerHTML = `
                <h4 class="font-semibold mb-2">æ¸¬è©¦çµæœç¸½è¦½:</h4>
                <p class="mb-2"><strong>é€šéç‡: ${passedCount}/${totalCount} (${Math.round((passedCount / totalCount) * 100)}%)</strong></p>
                ${results.join('')}
                <div class="mt-4 p-3 rounded ${passedCount === totalCount ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                    ${
                      passedCount === totalCount
                        ? 'ğŸ‰ æ‰€æœ‰çµ„ä»¶æ¸¬è©¦é€šéï¼çµ„ä»¶åº«é‹è¡Œæ­£å¸¸ã€‚'
                        : 'âš ï¸ éƒ¨åˆ†çµ„ä»¶æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯ã€‚'
                    }
                </div>
            `;

        // é¡¯ç¤ºæˆåŠŸæç¤º
        if (passedCount === totalCount) {
          toast.success('æ‰€æœ‰æ¸¬è©¦é€šéï¼çµ„ä»¶åº«é‹è¡Œæ­£å¸¸ ğŸ‰');
        } else {
          toast.warning(`${passedCount}/${totalCount} æ¸¬è©¦é€šéï¼Œè«‹æª¢æŸ¥å¤±æ•—é …ç›®`);
        }
      }
    </script>
  </body>
</html>
