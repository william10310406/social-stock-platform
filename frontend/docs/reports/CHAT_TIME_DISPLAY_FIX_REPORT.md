# èŠå¤©æ™‚é–“é¡¯ç¤ºä¿®å¾©å ±å‘Š

**æ—¥æœŸ**: 2025-06-22  
**å•é¡Œ**: å³æ™‚èŠå¤©æ™‚é–“é¡¯ç¤ºéŒ¯èª¤  
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©  

## å•é¡Œåˆ†æ

ç”¨æˆ¶åæ˜ å³æ™‚èŠå¤©åŠŸèƒ½ä¸­çš„æ™‚é–“é¡¯ç¤ºæœ‰å•é¡Œã€‚ç¶“éåˆ†æç™¼ç¾ä»¥ä¸‹æ ¹æœ¬åŸå› ï¼š

### 1. æ™‚å€ä¸ä¸€è‡´å•é¡Œ
- **å¾Œç«¯**: æ··ç”¨ `datetime.utcnow()` å’Œ `db.func.now()`
- **è³‡æ–™åº«**: MSSQL ä½¿ç”¨æœ¬åœ°æ™‚é–“
- **å‰ç«¯**: ç¼ºä¹å¼·å¥çš„æ™‚é–“æ ¼å¼åŒ–è™•ç†

### 2. å‰ç«¯æ™‚é–“æ ¼å¼åŒ–éæ–¼ç°¡å–®
- åŸå§‹ `formatTime` å‡½æ•¸åŠŸèƒ½æœ‰é™
- æ²’æœ‰éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- ç¼ºå°‘ç´°åˆ†çš„æ™‚é–“é¡¯ç¤ºï¼ˆå¦‚åˆ†é˜å‰ã€å°æ™‚å‰ç­‰ï¼‰

## ä¿®å¾©æ–¹æ¡ˆ

### ğŸ”§ å¾Œç«¯ä¿®å¾©

#### 1. çµ±ä¸€æ™‚å€ç®¡ç†
```python
from datetime import datetime, timezone

def get_utc_now():
    """ç²å–ç•¶å‰ UTC æ™‚é–“"""
    return datetime.now(timezone.utc)

def format_datetime_for_response(dt):
    """æ ¼å¼åŒ–æ™‚é–“ç”¨æ–¼ API å›æ‡‰"""
    if dt is None:
        return None
    if dt.tzinfo is None:
        # å¦‚æœæ²’æœ‰æ™‚å€ä¿¡æ¯ï¼Œå‡è¨­æ˜¯ UTC
        dt = dt.replace(tzinfo=timezone.utc)
    return dt.isoformat()
```

#### 2. æ›´æ–°èŠå¤©åŠŸèƒ½æ™‚é–“è™•ç†
- æ‰€æœ‰æ™‚é–“æ“ä½œä½¿ç”¨ `get_utc_now()`
- æ‰€æœ‰ API å›æ‡‰ä½¿ç”¨ `format_datetime_for_response()`
- ç¢ºä¿æ™‚å€ä¸€è‡´æ€§

### ğŸ¨ å‰ç«¯ä¿®å¾©

#### 1. å¢å¼·æ™‚é–“æ ¼å¼åŒ–å‡½æ•¸
```javascript
const formatTime = (dateString) => {
  try {
    // è™•ç†å„ç¨®æ™‚é–“æ ¼å¼ä¸¦é©—è­‰
    let date = new Date(dateString);
    if (isNaN(date.getTime())) {
      return 'ç„¡æ•ˆæ™‚é–“';
    }
    
    const now = new Date();
    const diffMs = now - date;
    const diffMinutes = Math.floor(diffMs / (1000 * 60));
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

    // æ™ºèƒ½æ™‚é–“é¡¯ç¤º
    if (diffMinutes < 1) return 'å‰›å‰›';
    if (diffMinutes < 60) return `${diffMinutes}åˆ†é˜å‰`;
    if (diffDays === 0) return date.toLocaleTimeString('zh-TW', {...});
    if (diffDays === 1) return `æ˜¨å¤© ${date.toLocaleTimeString('zh-TW', {...})}`;
    if (diffDays < 7) return `é€±${day} ${time}`;
    // ... æ›´å¤šé‚è¼¯
  } catch (error) {
    return 'æ™‚é–“éŒ¯èª¤';
  }
};
```

#### 2. æ–°å¢åŠŸèƒ½ç‰¹æ€§
- **å³æ™‚åé¥‹**: "å‰›å‰›"ã€"Xåˆ†é˜å‰"
- **ä»Šæ—¥æ™‚é–“**: é¡¯ç¤ºå…·é«”æ™‚é–“ "14:30"
- **æ˜¨å¤©**: "æ˜¨å¤© 14:30"
- **æœ¬é€±**: "é€±ä¸‰ 14:30"
- **è¼ƒæ—©**: "1/15 14:30" æˆ– "2024/12/31"
- **éŒ¯èª¤è™•ç†**: å„ªé›…è™•ç†ç„¡æ•ˆæ™‚é–“

## æ¸¬è©¦é©—è­‰

### âœ… å–®å…ƒæ¸¬è©¦çµæœ
```bash
=== èŠå¤©æ™‚é–“é¡¯ç¤ºæ¸¬è©¦ ===
ç¾åœ¨æ™‚é–“: å‰›å‰›
5åˆ†é˜å‰: 5åˆ†é˜å‰
2å°æ™‚å‰: 20:35
æ˜¨å¤©: æ˜¨å¤© 22:35
ä¸€é€±å‰: 6/15 22:35
ä»Šå¹´1æœˆ1æ—¥: 1/1 12:00
å»å¹´12æœˆ31æ—¥: 2024/12/31
ç„¡æ•ˆæ™‚é–“: ç„¡æ•ˆæ™‚é–“
UTCæ ¼å¼: 5åˆ†é˜å‰
æœ¬åœ°æ™‚é–“æ ¼å¼: 14:30
=== æ¸¬è©¦å®Œæˆ ===
```

### âœ… æ•´åˆæ¸¬è©¦
- å¾Œç«¯å®¹å™¨é‡å•ŸæˆåŠŸ
- å‰ç«¯å®¹å™¨é‡å•ŸæˆåŠŸ
- API æ™‚é–“æ ¼å¼çµ±ä¸€ç‚º ISO 8601 + UTC
- æ‰€æœ‰æ™‚é–“æ“ä½œä½¿ç”¨çµ±ä¸€å‡½æ•¸

## æŠ€è¡“æ”¹é€²

### ğŸ¯ æ™‚é–“è™•ç†æ¨™æº–åŒ–
1. **å¾Œç«¯çµ±ä¸€**: æ‰€æœ‰æ™‚é–“æ“ä½œä½¿ç”¨ UTC
2. **API æ¨™æº–**: ISO 8601 æ ¼å¼å›å‚³
3. **å‰ç«¯æ™ºèƒ½**: æœ¬åœ°åŒ–é¡¯ç¤º + éŒ¯èª¤è™•ç†
4. **æ™‚å€æ„è­˜**: è‡ªå‹•è™•ç†æ™‚å€è½‰æ›

### ğŸ”„ å¯ç¶­è­·æ€§æå‡
1. **å–®ä¸€è²¬ä»»**: æ™‚é–“å·¥å…·å‡½æ•¸ç¨ç«‹
2. **éŒ¯èª¤å®¹å¿**: å¼·å¥çš„éŒ¯èª¤è™•ç†
3. **æ¸¬è©¦è¦†è“‹**: å®Œæ•´å–®å…ƒæ¸¬è©¦
4. **æ–‡æª”å®Œæ•´**: è©³ç´°æŠ€è¡“æ–‡æª”

## å½±éŸ¿ç¯„åœ

### âœ… ä¿®å¾©æ•ˆæœ
- èŠå¤©è¨Šæ¯æ™‚é–“é¡¯ç¤ºæº–ç¢º
- å°è©±åˆ—è¡¨æ™‚é–“æ ¼å¼çµ±ä¸€
- è·¨æ™‚å€ç”¨æˆ¶é«”é©—ä¸€è‡´
- ç³»çµ±æ™‚é–“è™•ç†æ¨™æº–åŒ–

### ğŸ“ˆ ç”¨æˆ¶é«”é©—æ”¹å–„
- **ç›´è§€é¡¯ç¤º**: "5åˆ†é˜å‰" vs "2025-06-22T14:30:00Z"
- **æœ¬åœ°åŒ–**: ä¸­æ–‡é€±æ—¥æœŸ + 24å°æ™‚åˆ¶
- **æ™ºèƒ½åˆ‡æ›**: æ ¹æ“šæ™‚é–“é–“éš”è‡ªå‹•åˆ‡æ›é¡¯ç¤ºæ ¼å¼
- **éŒ¯èª¤å‹å¥½**: ç„¡æ•ˆæ™‚é–“å„ªé›…é™ç´š

## å¾ŒçºŒå»ºè­°

### ğŸ¯ çŸ­æœŸå„ªåŒ–
1. å¢åŠ èŠå¤©åŠŸèƒ½çš„å®Œæ•´ç«¯åˆ°ç«¯æ¸¬è©¦
2. ç›£æ§æ™‚é–“é¡¯ç¤ºçš„ç”¨æˆ¶åé¥‹
3. è€ƒæ…®å¢åŠ ç”¨æˆ¶æ™‚å€è¨­å®šåŠŸèƒ½

### ğŸš€ é•·æœŸæ”¹é€²
1. å¯¦æ–½å…¨ç«™çµ±ä¸€æ™‚é–“è™•ç†ç­–ç•¥
2. è€ƒæ…®åŠ å…¥ç›¸å°æ™‚é–“è‡ªå‹•æ›´æ–°ï¼ˆå¦‚"1åˆ†é˜å‰"è®Š"2åˆ†é˜å‰"ï¼‰
3. æ”¯æ´å¤šèªè¨€æ™‚é–“æ ¼å¼

---

**ä¿®å¾©å®Œæˆæ™‚é–“**: 2025-06-22 22:35 (UTC+8)  
**æ¸¬è©¦ç‹€æ…‹**: âœ… é€šé  
**éƒ¨ç½²ç‹€æ…‹**: âœ… å·²ä¸Šç·š  
**å½±éŸ¿ç”¨æˆ¶**: æ‰€æœ‰èŠå¤©åŠŸèƒ½ç”¨æˆ¶ 